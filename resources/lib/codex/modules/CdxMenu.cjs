"use strict";var le=Object.defineProperty,ne=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var I=(e,a,u)=>a in e?le(e,a,{enumerable:!0,configurable:!0,writable:!0,value:u}):e[a]=u,F=(e,a)=>{for(var u in a||(a={}))ie.call(a,u)&&I(e,u,a[u]);if(D)for(var u of D(a))ue.call(a,u)&&I(e,u,a[u]);return e},z=(e,a)=>ne(e,ae(a));var E=(e,a,u)=>new Promise((C,d)=>{var B=i=>{try{h(u.next(i))}catch(p){d(p)}},o=i=>{try{h(u.throw(i))}catch(p){d(p)}},h=i=>i.done?C(i.value):Promise.resolve(i.value).then(B,o);h((u=u.apply(e,a)).next())});const l=require("vue"),oe=require("./CdxMenuItem.cjs"),re=require("./CdxProgressBar.cjs"),se=require("./useGeneratedId.cjs"),de=require("./useIntersectionObserver.cjs"),ce=require("./useSplitAttributes.cjs"),fe=require("./_plugin-vue_export-helper.js");function L(e){return e!==null&&Array.isArray(e)}const he=l.defineComponent({name:"CdxMenu",components:{CdxMenuItem:oe,CdxProgressBar:re},inheritAttrs:!1,props:{menuItems:{type:Array,required:!0},footer:{type:Object,default:null},selected:{type:[String,Number,Array,null],required:!0},expanded:{type:Boolean,required:!0},showPending:{type:Boolean,default:!1},visibleItemLimit:{type:Number,default:null},showThumbnail:{type:Boolean,default:!1},boldLabel:{type:Boolean,default:!1},hideDescriptionOverflow:{type:Boolean,default:!1},searchQuery:{type:String,default:""},showNoResultsSlot:{type:Boolean,default:null}},emits:["update:selected","update:expanded","menu-item-click","menu-item-keyboard-navigation","load-more"],expose:["isExpanded","clearActive","getHighlightedMenuItem","getHighlightedViaKeyboard","delegateKeyNavigation"],setup(e,{emit:a,slots:u,attrs:C}){const d=l.computed(()=>(e.footer&&e.menuItems?[...e.menuItems,e.footer]:e.menuItems).map(n=>z(F({},n),{id:se("menu-item")}))),B=l.computed(()=>u["no-results"]?e.showNoResultsSlot!==null?e.showNoResultsSlot:d.value.length===0:!1),o=l.ref(null),h=l.ref(!1),i=l.ref(null),p="additions removals";let c="",m=null;function v(){c="",m!==null&&(clearTimeout(m),m=null)}function k(){m!==null&&clearTimeout(m),m=setTimeout(v,1500)}function x(){var t;return(t=d.value.find(n=>L(e.selected)?e.selected.indexOf(n.value)!==-1:n.value===e.selected))!=null?t:null}const S=l.computed(()=>L(e.selected));function U(t){return L(e.selected)?e.selected.indexOf(t)!==-1:t===e.selected}function $(t){if(L(e.selected)){const n=e.selected.indexOf(t)===-1?e.selected.concat(t):e.selected.filter(s=>s!==t);a("update:selected",n)}else a("update:selected",t)}function g(t,n){if(!(n&&n.disabled))switch(t){case"selected":n&&$(n.value),S.value||a("update:expanded",!1),i.value=null;break;case"highlighted":o.value=n!=null?n:null,h.value=!1;break;case"highlightedViaKeyboard":o.value=n!=null?n:null,h.value=!0;break;case"active":i.value=n!=null?n:null;break}}const b=l.computed(()=>{if(o.value!==null)return d.value.findIndex(t=>t.value===o.value.value)});function A(t){t&&(g("highlightedViaKeyboard",t),a("menu-item-keyboard-navigation",t))}function H(t){var r;const n=w=>{for(let f=w-1;f>=0;f--)if(!d.value[f].disabled)return d.value[f]};t=t!=null?t:d.value.length;const s=(r=n(t))!=null?r:n(d.value.length);A(s)}function q(t){var r;const n=w=>d.value.find((f,N)=>!f.disabled&&N>w);t=t!=null?t:-1;const s=(r=n(t))!=null?r:n(-1);A(s)}function W(t){if(t.key==="Clear")return v(),!0;if(t.key==="Backspace")return c=c.slice(0,-1),k(),!0;if(t.key.length===1&&!t.metaKey&&!t.ctrlKey&&!t.altKey){if(e.expanded||a("update:expanded",!0),t.key===" "&&c.length<1)return!1;c+=t.key.toLowerCase();const n=c.length>1&&c.split("").every(f=>f===c[0]);let s=d.value,r=c;n&&b.value!==void 0&&(s=s.slice(b.value+1).concat(s.slice(0,b.value)),r=c[0]);const w=s.find(f=>{var N;return!f.disabled&&String((N=f.label)!=null?N:f.value).toLowerCase().startsWith(r)});return w&&(g("highlightedViaKeyboard",w),M()),k(),!0}return!1}function _(t,{prevent:n=!0,characterNavigation:s=!1}={}){if(s){if(W(t))return t.preventDefault(),!0;v()}function r(){n&&(t.preventDefault(),t.stopPropagation())}switch(t.key){case"Enter":case" ":return r(),e.expanded?(o.value&&h.value&&$(o.value.value),S.value||a("update:expanded",!1)):a("update:expanded",!0),!0;case"Tab":return e.expanded&&o.value&&h.value&&!S.value&&($(o.value.value),a("update:expanded",!1)),!0;case"ArrowUp":return r(),e.expanded?(o.value===null&&g("highlightedViaKeyboard",x()),H(b.value)):a("update:expanded",!0),M(),!0;case"ArrowDown":return r(),e.expanded?(o.value===null&&g("highlightedViaKeyboard",x()),q(b.value)):a("update:expanded",!0),M(),!0;case"Home":return r(),e.expanded?(o.value===null&&g("highlightedViaKeyboard",x()),q()):a("update:expanded",!0),M(),!0;case"End":return r(),e.expanded?(o.value===null&&g("highlightedViaKeyboard",x()),H()):a("update:expanded",!0),M(),!0;case"Escape":return r(),a("update:expanded",!1),!0;default:return!1}}function R(){g("active",null)}const y=[],P=l.ref(void 0),Q=de(P,{threshold:.8});l.watch(Q,t=>{t&&a("load-more")});function j(t,n){if(t){y[n]=t.$el;const s=e.visibleItemLimit;if(!s||e.menuItems.length<s)return;const r=Math.min(s,Math.max(2,Math.floor(.2*e.menuItems.length)));n===e.menuItems.length-r&&(P.value=t.$el)}}const K=l.ref();function M(){const t=K.value&&K.value.scrollHeight>K.value.clientHeight;if(b.value===void 0||!t)return;const n=b.value>=0?b.value:0;y[n].scrollIntoView({behavior:"smooth",block:"nearest"})}const V=l.ref(null),T=l.ref(null);function O(){return E(this,null,function*(){yield l.nextTick(),G(),J(),yield l.nextTick(),M()})}function G(){if(e.footer){const t=y[y.length-1];T.value=t.scrollHeight}else T.value=null}function J(){if(!e.visibleItemLimit||y.length<=e.visibleItemLimit){V.value=null;return}const t=y[0].getBoundingClientRect().top,n=y[e.visibleItemLimit].getBoundingClientRect().top;V.value=n-t+2}l.onMounted(()=>{document.addEventListener("mouseup",R)}),l.onUnmounted(()=>{document.removeEventListener("mouseup",R)}),l.watch(l.toRef(e,"expanded"),t=>E(this,null,function*(){if(t){const n=x();n&&!o.value&&g("highlighted",n),yield O()}else g("highlighted",null)})),l.watch(l.toRef(e,"menuItems"),t=>E(this,null,function*(){t.length<y.length&&(y.length=t.length),e.expanded&&(yield O())}),{deep:!0});const X=l.computed(()=>({"max-height":V.value?"".concat(V.value,"px"):void 0,"margin-bottom":T.value?"".concat(T.value,"px"):void 0})),Y=l.computed(()=>({"cdx-menu--has-footer":!!e.footer})),{rootClasses:Z,rootStyle:ee,otherAttrs:te}=ce(C,Y);return{listBoxStyle:X,rootClasses:Z,rootStyle:ee,otherAttrs:te,assignTemplateRef:j,computedMenuItems:d,computedShowNoResultsSlot:B,highlightedMenuItem:o,highlightedViaKeyboard:h,activeMenuItem:i,handleMenuItemChange:g,handleKeyNavigation:_,ariaRelevant:p,isMultiselect:S,isItemSelected:U,menuListbox:K}},methods:{isExpanded(){return this.expanded},getHighlightedMenuItem(){return this.expanded?this.highlightedMenuItem:null},getHighlightedViaKeyboard(){return this.highlightedViaKeyboard},clearActive(){this.handleMenuItemChange("active",null)},delegateKeyNavigation(e,{prevent:a=!0,characterNavigation:u=!1}={}){return this.handleKeyNavigation(e,{prevent:a,characterNavigation:u})}}}),ve=["aria-live","aria-relevant","aria-multiselectable"],ge={key:0,class:"cdx-menu__pending cdx-menu-item"},me={key:1,class:"cdx-menu__no-results cdx-menu-item",role:"option"};function ye(e,a,u,C,d,B){const o=l.resolveComponent("cdx-menu-item"),h=l.resolveComponent("cdx-progress-bar");return l.withDirectives((l.openBlock(),l.createElementBlock("div",{class:l.normalizeClass(["cdx-menu",e.rootClasses]),style:l.normalizeStyle(e.rootStyle)},[l.createElementVNode("ul",l.mergeProps({ref:"menuListbox",class:"cdx-menu__listbox",role:"listbox",style:e.listBoxStyle,"aria-live":e.showPending?"polite":void 0,"aria-relevant":e.showPending?e.ariaRelevant:void 0,"aria-multiselectable":e.isMultiselect?!0:void 0},e.otherAttrs),[e.showPending&&e.computedMenuItems.length===0&&e.$slots.pending?(l.openBlock(),l.createElementBlock("li",ge,[l.renderSlot(e.$slots,"pending")])):l.createCommentVNode("v-if",!0),e.computedShowNoResultsSlot?(l.openBlock(),l.createElementBlock("li",me,[l.renderSlot(e.$slots,"no-results")])):l.createCommentVNode("v-if",!0),(l.openBlock(!0),l.createElementBlock(l.Fragment,null,l.renderList(e.computedMenuItems,(i,p)=>{var c,m;return l.openBlock(),l.createBlock(o,l.mergeProps({key:i.value,ref_for:!0,ref:v=>e.assignTemplateRef(v,p)},i,{selected:e.isItemSelected(i.value),active:i.value===((c=e.activeMenuItem)==null?void 0:c.value),highlighted:i.value===((m=e.highlightedMenuItem)==null?void 0:m.value),"show-thumbnail":e.showThumbnail,"bold-label":e.boldLabel,"hide-description-overflow":e.hideDescriptionOverflow,"search-query":e.searchQuery,multiselect:e.isMultiselect,onChange:(v,k)=>e.handleMenuItemChange(v,k?i:null),onClick:v=>e.$emit("menu-item-click",i)}),{default:l.withCtx(()=>{var v,k;return[l.renderSlot(e.$slots,"default",{menuItem:i,active:i.value===((v=e.activeMenuItem)==null?void 0:v.value)&&i.value===((k=e.highlightedMenuItem)==null?void 0:k.value)})]}),_:2},1040,["selected","active","highlighted","show-thumbnail","bold-label","hide-description-overflow","search-query","multiselect","onChange","onClick"])}),128)),e.showPending?(l.openBlock(),l.createBlock(h,{key:2,class:"cdx-menu__progress-bar",inline:!0})):l.createCommentVNode("v-if",!0)],16,ve)],6)),[[l.vShow,e.expanded]])}const be=fe._export_sfc(he,[["render",ye]]);module.exports=be;
